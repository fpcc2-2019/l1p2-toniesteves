---
title: "Fundamentos de Pesquisa em Ciência da Computação 2"
output:
  html_document:
    df_print: paged
---

## L2P2 - Antonio Esteves

## **Explorando e Inferindo dados das Sessões, Buscas e Navegações da Wikimedia**

Neste relatório, usa-se a exploração de dados da Wikimedia Foundation, apresentando conclusões de inferências estatísticas sobre o dataset disponibilizado por eles e seguindo instruções da tarefa original, respondendo as quatro perguntas elencadas na mesma.

1. Qual é a nossa taxa de cliques geral diária? Como isso varia entre os grupos?

2. Quais resultados as pessoas tendem a tentar primeiro? Como isso muda no dia-a-dia?

3. Qual é a nossa taxa de resultados zero no geral? Como isso varia entre os grupos?

4. A duração da sessão é aproximadamente o tempo entre o primeiro e o último evento de uma sessão. Escolha uma variável do conjunto de dados e descreva sua relação com o tamanho da sessão. Visualize o relacionamento.

5. Resuma suas descobertas em um resumo executivo.

Nas seções um e dois estão as bibliotecas utilizadas e o os dados utilizados na análise. Na seção 3 estão as respostas para as perguntas elencadas no relatório e na última seção estão as conclusões obtidas das análises sobre os dados.


## **1.** Importando as bibliotecas utilizadas.

```{r}
library(tidyverse)
library(lubridate)
```



## **2.** Lendo dataset de buscas para análise.

```{r ETL}
buscas = read_csv("../data/search_data.csv")
```

### 2.1 Tratamento dos dados

```{r}
glimpse(buscas)
```

Para uma análise melhor, foram realizados alguns tratamento nos dados, retirando registros com comportamentos indesejados.

O primeiro registro retirado foi onde o local do primeiro click é maior que a quantidade de resultados da busca (‘first_click’ > ‘results’).

```{r}
search_dates <- buscas %>% 
  mutate(search_date = format(session_start_date, "%d-%m-%Y"))

glimpse(search_dates)
```

### 2.2 Variáveis Utilizadas nas análises
As variáveis utilizadas podem serem vistas abaixo:

`group` : Um marcador (“a” ou “b”);

`results` : Número de ocorrências retornadas para o usuário;

`num_clicks`: Número de ocorrências clicadas pelo usuário;

`first_click`: Posição da ocorrência que o usuário clicou primeiro;

`session_start_date`: Data do início da pesquisa;

`session_length`: Duração da sessão.


## **3.** Respostas e Análise exploratória de dados.



### 3.1 Qual é a taxa de cliques geral diária? Como isso varia entre os grupos?

```{r}
clicked = search_dates %>%
  filter((num_clicks > 0) & (first_click <= results) & (results > 0)) %>%
  group_by(search_date)

per_date = clicked %>% 
  summarize(total_clicks = n(), clickthrough_rate = (total_clicks/nrow(search_dates)))

per_date %>%
  ggplot(aes(x=search_date,y=clickthrough_rate)) + 
  geom_point(
    color="#44cde8",
    size=3
  ) + 
  geom_line(aes(group=1),linetype='dotted') +
  labs(
      title = "Figura 1 - Taxa de Cliques Geral Diária", 
      x = "Data de Acesso.", 
      y = "Taxa Geral de Cliques",
      subtitle = "Taxa de cliques para datas em que ocorreram buscas.",
      fill = "Data da busca")
```

```{r}
clicked = search_dates %>%
  filter((num_clicks > 0) & (first_click <= results) & (results > 0)) %>%
  group_by(search_date, group)

per_date = clicked %>% 
  summarize(total_clicks = n(), clickthrough_rate = (total_clicks/nrow(search_dates)))

per_date %>%
  group_by(group) %>% 
  ggplot(aes(x=search_date,y=clickthrough_rate)) + 
  geom_point(
    aes(color=group),
    size=3
  ) + 
  scale_color_manual(values=c("#6ab3a2", "brown")) +
  geom_line(aes(group=group),linetype='dotted') +
  labs(
      title = "Figura 2 - Variação da Taxa de Cliques Geral Diária Entre Grupos", 
      x = "Data de Acesso.", 
      y = "Taxa Geral de Cliques",
      subtitle = "Taxa de cliques para datas para datas em que ocorreram buscas.",
      fill = "Data da busca",
      color = "Grupo")
```

### 3.2 Quais resultados as pessoas tendem a tentar primeiro? Como isso muda no dia-a-dia?


```{r}
search_dates %>% 
  filter(!is.na(first_click) & first_click != 0) %>%
  ggplot(aes(x=first_click)) + 
  geom_bar(color = "black") + 
  scale_x_log10() +
  labs(
      title = "Figura 3 - Preferência do Primeiro Acesso Entre os Resultados",
      x = "Resultados Acessados", 
      y = "Quantidade de Acessos", 
      subtitle = "Taxa de cliques para datas para datas em que ocorreram buscas."
      )
```

# Rever histogramas, melhorar visualização

```{r}
search_dates %>%
  arrange(search_date)%>%
    ggplot(aes(x = first_click, fill = search_date)) +
    geom_histogram(binwidth = 2, na.rm = TRUE) +
    scale_x_continuous(limits=c(0, 30)) +
    scale_y_continuous(limits=c(0, 1000)) +
    facet_wrap(~ search_date, nrow=2) + 
    labs(
      title = "Figura 4 - Link do Primeiro Acesso Entre os Resultados", 
      x = "Resultado Acessado.", 
      y = "Quantidade de Acesso",
      subtitle = "Resultados primeiramente acessados para datas que ocorreram buscas.",
      fill = "Data da busca")

```

# 3. Qual é a nossa taxa de resultados zero no geral? Como isso varia entre os grupos?

```{r}

no_results = search_dates %>%
  filter(results > 0) %>%
  group_by(search_date)

no_results_per_date = no_results %>%
  summarize(total_no_results = n(), no_results_rate = (total_no_results/nrow(search_dates)))

no_results_per_date %>%
  ggplot(aes(x=search_date,y=no_results_rate)) +
  geom_point(
    color="#44cde8",
    size=3
  ) +
  geom_line(aes(group=1),linetype='dotted') +
  labs(
      title = "Figura 5 - Taxa de Cliques Geral Diária",
      x = "Data de Acesso.",
      y = "Taxa Geral de Cliques",
      subtitle = "Taxa de cliques para datas em que ocorreram buscas.",
      fill = "Data da busca")



```


```{r}
no_results = search_dates %>%
  filter(results > 0) %>%
  group_by(search_date, group)

no_results_per_date = no_results %>%
  summarize(total_no_results = n(), no_results_rate = (total_no_results/nrow(search_dates)))

no_results_per_date %>%
  group_by(group) %>% 
  ggplot(aes(x=search_date,y=no_results_rate)) + 
  geom_point(
    aes(color=group),
    size=3
  ) + 
  scale_color_manual(values=c("orange", "navy blue")) +
  geom_line(aes(group=group),linetype='dotted') +
  labs(
      title = "Figura 6 - Variação da Taxa de Cliques Geral Diária Entre Grupos", 
      x = "Data de Acesso.", 
      y = "Taxa Geral de Cliques",
      subtitle = "Taxa de cliques para datas para datas em que ocorreram buscas.",
      fill = "Data da busca",
      color = "Grupo")
```

# 4. A duração da sessão é aproximadamente o tempo entre o primeiro e o último evento de uma sessão. Escolha uma variável do conjunto de dados e descreva sua relação com o tamanho da sessão. Visualize o relacionamento.


```{r}
buscas %>% 
    ggplot(aes(x = num_clicks)) +
    geom_density()

buscas %>% 
    ggplot(aes(x = num_clicks)) + 
    geom_histogram(binwidth = 5) 
```

