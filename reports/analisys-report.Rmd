---
title: "Antônio Esteves"
output: html_notebook
---

## O quê

Como usamos dados derivados dos logs de eventos da wikimedia, aqui primeiro exploramos esses logs para entender como os eventos foram coletados, e para procurar características inesperadas. 

```{r}
library(tidyverse)
library(lubridate)
library(gridExtra)
library(grid)
theme_set(theme_bw())
```


1. Qual é a nossa taxa de cliques geral diária? Como isso varia entre os grupos?

taxa de cliques = num_clicks/sessao

2. Quais resultados as pessoas tendem a tentar primeiro? Como isso muda no dia-a-dia?

3. Qual é a nossa taxa de resultados zero no geral? Como isso varia entre os grupos?

4. A duração da sessão é aproximadamente o tempo entre o primeiro e o último evento de uma sessão. Escolha uma variável do conjunto de dados e descreva sua relação com o tamanho da sessão. Visualize o relacionamento.

5. Resuma suas descobertas em um resumo executivo.

## Lendo os eventos

```{r ETL}
buscas = read_csv("../data/search_data.csv")
```


```{r}
glimpse(buscas)
```


```{r}
search_dates <- buscas %>% 
  mutate(search_date = format(session_start_date, "%d-%m-%Y"))

glimpse(search_dates)
```

```{r}
zero_results = buscas %>% 
    filter(results == 0)
```

```{r}
# session_duration = buscas %>% 
#     filter(results == 0)
```

```{r}
clickthrough_rate = search_dates %>%
  filter((num_clicks > 0) & (first_click > results)) %>% 
  group_by(search_date) %>%
  summarise(media = mean(num_clicks))
# 
# day = search_dates %>% 
#   filter(search_date == "01-03-2016")
# 
# sessions = search_dates %>%
#   filter(num_clicks > 2)
# 
# sessions

  
# clickthrough_rate = search_dates %>%
#   filter(num_clicks > 0) %>% 
#   group_by(search_date)%>%
#   summarise(CTR = (sum(num_clicks)/length(session_id)))
  # summarise(CTR = length(session_id))

# clickthrough_rate = search_dates %>%
#   filter(search_date == "01-03-2016")
  # summarise(CTR = (sum(num_clicks)/count(session_id)))
  # summarise(CTR = length(session_id))


# clickthrough_rate = search_dates %>%
#     group_by(round_date(search_date , unit="day"), group) %>%  
#     summarise(somatorio = sum(num_clicks)) %>% 
#     head()
#   
```

```{r}
search_dates %>%
    filter(group=="a") %>% 
    ggplot(aes(x = search_date, y=media)) +
    # geom_jitter(aes(y = num_clicks), width = .1, alpha = .5 ) +
    geom_line(color="#69b3a2") +
    geom_point(
      data = clickthrough_rate,
      aes(y = media),
      color = "red",
      shape = 15,
      size = 3
    )

# search_dates %>%
#     filter(group=="b") %>% 
#     ggplot(aes(x = search_date)) +
#     geom_jitter(aes(y = num_clicks), width = .1, alpha = .7, color="#69b3a2" ) +
#     geom_point(
#       data = clickthrough_rate,
#       aes(y = media),
#       color = "red",
#       shape = 15,
#       size = 3
#     ) +
#     labs(
#         y = "Número de Cliques ao dia",
#         x = "Datas em que foram efetuadas buscas",
#         title = "Taxa de cliques geral diária",
#         subtitle = "Quadrados representam a Taxa de cliques ao dia."
#     )
```

```{r}
buscas %>% 
    ggplot(aes(x = num_clicks)) +
    geom_density()

buscas %>% 
    ggplot(aes(x = num_clicks)) + 
    geom_histogram(binwidth = 5) 
```

